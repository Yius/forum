<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link href="webDefault/bootstrap.min.css" rel="stylesheet" />
  <link href="css/posts.css" rel="stylesheet" />
  <script src="webDefault/jquery-3.4.1.min.js"></script>
  <script src="webDefault/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="css/index.css">
  <style>
    .file-box {
            position: relative;
            display: inline-block;
            width:100px;
            height:100px;
            background:url('images/uploadPc.png')no-repeat;
            background-size:100px 100px;
        }
        #input_file{
            width:100%;
            height:100%;
            opacity: 0;
            filter:alpha(opacity=0);
        }
  </style>
</head>

<body>
  <!-- <p>
    <a class="btn btn-primary" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false"
      aria-controls="collapseExample">
      Link with href
    </a>
  </p> -->

  <div class="container">
    <div class="list-unstyled card" style="margin: 3% auto;" id="detailPosition">
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"></li>
        </ol>
      </nav>
      <div class="media card-body" style="border-bottom: solid gainsboro 1px;">
        <div>
          <img class="align-self-start mr-4 indexBox " src="images/index_box.png">
          <br>
          <p style="margin-top: 5%;text-align: center;padding-right: 2em;">${dsadsa}</p>
        </div>
        <div class="media-body">
          <p>${postArr[i].content}</p>
          <span style="font-size:10px;float:right;">发贴时间:${transformTime(postArr[i].publishtime)}</span>
          <br>
          <a style="float: right;" data-toggle="collapse" href="#replyCollapse" role="button">
            查看回复(${postArr[i].replys})
          </a>
          <br>
          <div class="collapse list-unstyled card" id="replyCollapse">
            <!-- 内楼一楼 -->
            <div class="media card-body" style="border-bottom: solid gainsboro 1px;">
              <div>
                <img class="align-self-start mr-4 indexBox " src="images/index_box.png">
                <br>
                <p style="margin-top: 5%;text-align: center;padding-right: 2em;">${dsadas}</p>
              </div>
              <div class="media-body">
                <p>${postArr[i].content}</p>
                <span style="font-size:10px;float:right;">
                  回复时间:${transformTime(postArr[i].publishtime)}</span>
                <br>
                <a style="float: right;" data-toggle="collapse" href="showReplys(${postArr[i].id},1)" role="button"
                  data-field=${postArr[i].id}>
                  回复
                </a>
              </div>
            </div>
            <!-- 内楼二楼 -->
            <div class="media card-body" style="border-bottom: solid gainsboro 1px;">
              <div>
                <img class="align-self-start mr-4 indexBox " src="images/index_box.png">
                <br>
                <p style="margin-top: 5%;text-align: center;padding-right: 2em;"></p>
              </div>
              <div class="media-body">
                <p>${postArr[i].content}</p>
                <span style="font-size:10px;float:right;">
                  回复时间:${transformTime(postArr[i].publishtime)}</span>
                <br>
                <a style="float: right;" data-toggle="collapse" href="showReplys(${postArr[i].id},1)" role="button"
                  data-field=${postArr[i].id}>
                  回复
                </a>
              </div>
            </div>
            <nav>
              <ul class="pagination justify-content-center" style="margin-top: 2%;" id="bottomPage">
                <li class="page-item">
                  <a class="page-link disabled">
                    <span>&laquo;</span>
                  </a>
                </li>
                <li class="page-item active"><a class="page-link" href="posts.html?p=${i}">${i}</a></li>
              </ul>
            </nav>
            <button class="btn btn-primary" style="width: 10%;margin-left: 85%;margin-bottom: 2%;"
              data-toggle="collapse" href="#cc">我说几句</button>
            <!-- 内部回复框 -->
            <div class="collapse" id="cc">
              <div class="card">
                <div class="card-body">
                  <div class="form-group">
                    <textarea class="form-control" id="content" rows="3"></textarea>
                  </div>
                  <button type="button" class="btn btn-primary" style="float: right;">回复</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-body">
        <form>
          <div class="form-group">
            <label for="title">标题</label>
            <input type="email" class="form-control" id="title">
          </div>
          <div class="form-group">
            <label for="content">贴子内容</label>
            <textarea class="form-control" id="content" rows="10"></textarea>
          </div>
          <button type="button" class="btn btn-primary">发布贴子</button>
        </form>
      </div>
    </div>

    <div class="input-file-box">
      <span>点击上传图片</span>
      <input type="file" name="" id="uploadfile">
    </div>
    <img id="img-box">

    <!-- <div class="input-group mb-3"> -->
      <div class="custom-file">
          <input type="file" class="custom-file-input" id="inputGroupFile02" onclick="alert('good')"/>
          <label class="custom-file-label" for="inputGroupFile02" id ="filename"></label>
      </div>
  <!-- </div> -->


  <div class="file-box" style="border: red solid;">
    <input type="file" value="" name="file" id = "input_file"
       accept="image/gif,image/jpeg,image/jpg,image/png,image/svg" οnchange="imgPreview(this,0)" >
</div>


  </div>


</body>
<script>
  function imgPreview(fileDom,i) {
        //判断是否支持FileReader
        if(window.FileReader) {
            var reader = new FileReader();
        } else {
            alert("您的设备不支持图片预览功能，如需该功能请升级您的设备！");
        }
        //获取文件
        var file = fileDom.files[0];
        var imageType = /^image\//;
        //是否是图片
        if(!imageType.test(file.type)) {
            alert("请选择图片！");
            return;
        }
        //读取完成
        reader.onload = function(e) {
            //图片路径设置为读取的图片
            // img.src = e.target.result;
            console.log(document.getElementsByClassName('file-box'));
            document.getElementsByClassName('file-box')[i].style.background = "url("+e.target.result+")no-repeat";//回显图片
            document.getElementsByClassName('file-box')[i].style.backgroundSize = '200px 160px';
            console.log('reader',reader)
        };
        reader.readAsDataURL(file);
    }

    $('#inputGroupFile02').on('change', function () {
      var fileName = $(this).val();
      var cleanFileName = fileName.replace('C:\\fakepath\\', " ");
      $(this).next('.custom-file-label').html(cleanFileName);
  })


  window.onload = function () {
    var input = document.getElementById("uploadfile");
    var div;
    // 当用户上传时触发事件
    input.onchange = function () {
      readFile(this);
    }
    //处理图片并添加都dom中的函数
    var readFile = function (obj) {
      // 获取input里面的文件组
      var file = obj.files[0];
      var reader = new FileReader();
      reader.readAsDataURL(file);
      // 当文件读取成功时执行的函数
      reader.onload = function (e) {
        $("#img-box").attr("src", this.result);
      }
    }
  }


</script>

</html>